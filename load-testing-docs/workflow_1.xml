<?xml version="1.0"?>
<!DOCTYPE tsung SYSTEM "/usr/local/share/tsung/tsung-1.0.dtd" [] >
<tsung loglevel="notice">
  <clients>
    <client host="localhost" maxusers="32768" use_controller_vm="true" />
  </clients>

  <servers>
    <server host="localhost" port="3000" type="tcp"></server>
  </servers>

  <load>
    <arrivalphase phase="1" duration="5" unit="second">
      <users arrivalrate="1" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="2" duration="5" unit="second">
      <users arrivalrate="2" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="3" duration="5" unit="second">
      <users arrivalrate="4" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="4" duration="5" unit="second">
      <users arrivalrate="8" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="5" duration="5" unit="second">
      <users arrivalrate="16" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="6" duration="5" unit="second">
      <users arrivalrate="32" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="7" duration="5" unit="second">
      <users arrivalrate="64" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="8" duration="5" unit="second">
      <users arrivalrate="128" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="9" duration="5" unit="second">
      <users arrivalrate="256" unit="second"></users>
    </arrivalphase>
    <arrivalphase phase="10" duration="5" unit="second">
      <users arrivalrate="512" unit="second"></users>
    </arrivalphase>
  </load>

  <options>
    <!-- Set connection timeout to 2 seconds -->
    <option name="global_ack_timeout" value="2000"></option>
  </options>

  <sessions>
  
    <session name="create_poll" type="ts_http" weight="1">
        <request>
            <dyn_variable name="authenticity_token" xpath="/html/head/meta[@name='csrf-token']/@content"></dyn_variable>
            <http method="GET" url="/polls"></http>
        </request>
       <request subst="true"><http method="POST" url="/polls" contents="authenticity_token=%%_authenticity_token%%&amp;poll[title]=PollTest1&amp;poll[timeframe_start]=2020-01-08 04:05:06&amp;poll[timeframe_end]=2020-01-10 05:06:07"></http></request>
    </session>
  
  <session name="create_poll_populate_users" type="ts_http" weight="1">
        <request>
            <dyn_variable name="authenticity_token" xpath="/html/head/meta[@name='csrf-token']/@content"></dyn_variable>
            <http method="GET" url="/polls"></http>
        </request>
       <request subst="true">
            <dyn_variable name="redirect" re="Location: (http://.*)\r"/>
            <http method="POST" url="/polls" contents="authenticity_token=%%_authenticity_token%%&amp;poll[title]=PollTest2&amp;poll[timeframe_start]=2020-01-08 04:05:06&amp;poll[timeframe_end]=2020-01-10 05:06:07"></http>
       </request>
       <request subst="true"> 
            <dyn_variable name="authenticity_token_2" xpath="/html/head/meta[@name='csrf-token']/@content"></dyn_variable>
            <http method="GET" url="%%_redirect%%"></http>
       </request>
        <request subst="true">
            <http method="POST" url="%%_redirect%%/users" contents="authenticity_token=%%_authenticity_token_2%%&amp;user[name]=azfanclub"></http>
       </request>
    </session>
    
    <session name="user_enter_availability" type="ts_http" weight="1">
    	<!-- Need to handle the case of obtaining user id in order to direct to the right page -->
    	<!-- remove single poll id and single userid constriants! -->
    	<request>
            <dyn_variable name="authenticity_token" xpath="/html/head/meta[@name='csrf-token']/@content"></dyn_variable>
            <http method="GET" url="/polls/4607efdc-13a2-4837-8f46-207bddb81509/users/1"></http>
        </request>
        <request subst="true">
            <http method="POST" url="/polls/4607efdc-13a2-4837-8f46-207bddb81509/users/1/time_frames" contents="authenticity_token=%%_authenticity_token%%&amp;time_frame[start_time]=2020-01-08 04:40:06&amp;time_frame[end_time]=2020-01-08 05:06:07&amp;time_frame[tier]=1"></http>
       </request>
       <request>
            <dyn_variable name="authenticity_token_2" xpath="/html/head/meta[@name='csrf-token']/@content"></dyn_variable>
            <http method="GET" url="/polls/4607efdc-13a2-4837-8f46-207bddb81509/users/1"></http>
        </request>
        <request subst="true">
            <http method="POST" url="/polls/4607efdc-13a2-4837-8f46-207bddb81509/users/1/time_frames" contents="authenticity_token=%%_authenticity_token_2%%&amp;time_frame[start_time]=2020-01-09 01:05:06&amp;time_frame[end_time]=2020-01-09 03:06:07&amp;time_frame[tier]=2"></http>
       </request>
      
    <session name="view_poll" type="ts_http" weight="1">
        <request>
            <http method="GET" url="/polls"></http>
        </request>
    </session>	
       
    </session>
    
  </sessions>
  
  
  
</tsung>

